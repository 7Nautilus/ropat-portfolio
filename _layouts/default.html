<!DOCTYPE html>
<html lang="{{ page.lang | default: 'en' }}">
<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KN22K5FS');</script>
    <!-- End Google Tag Manager -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="language" content="{{ page.lang | default: 'en' }}"> 

    {% comment %} Si c'est une page de projet, charger les métadonnées depuis projects.yml {% endcomment %}
    {% if page.project_id %}
      {% assign project = site.data.projects | where: "project_title", page.project_id | first %}
      {% assign lang = page.lang | default: "fr" %}
      {% if project.seo %}
        {% assign page.title = project.seo.title[lang] %}
        {% assign page.meta_description = project.seo.meta_description[lang] %}
        {% assign page.meta_keywords = project.seo.meta_keywords[lang] %}
        {% assign page.canonical_url = project.seo.canonical_url[lang] %}
        {% assign page.og_title = project.seo.og_title[lang] %}
        {% assign page.og_description = project.seo.og_description[lang] %}
        {% assign page.og_url = project.seo.og_url[lang] %}
        {% assign page.og_image = project.seo.og_image %}
      {% endif %}
    {% endif %}

    {% assign page_path_no_lang = page.url | remove_first: "/fr" | remove_first: "/en" %}
    
    {% comment %} Gestion spéciale pour la page d'accueil {% endcomment %}
    {% if page_path_no_lang == "/index.html" or page_path_no_lang == "/" %}
      <link rel="alternate" hreflang="fr" href="{{ site.url }}/index.html" />
      <link rel="alternate" hreflang="en" href="{{ site.url }}/en/index.html" />
      <link rel="alternate" hreflang="x-default" href="{{ site.url }}/en/index.html" />
    {% else %}
      <link rel="alternate" hreflang="fr" href="{{ site.url }}/fr{{ page_path_no_lang }}" />
      <link rel="alternate" hreflang="en" href="{{ site.url }}/en{{ page_path_no_lang }}" />
      <link rel="alternate" hreflang="x-default" href="{{ site.url }}/en{{ page_path_no_lang }}" />
    {% endif %}

    <!-- SEO - Gestion des métadonnées -->
    {% if page.title %}
        <!-- Page avec métadonnées dans le front matter -->
        <title>{{ page.title }}</title>
        <meta name="title" content="{{ page.title }}">
        
        {% if page.meta_description %}
            <meta name="description" content="{{ page.meta_description }}">
        {% elsif page.lang == 'fr' %}
            <meta name="description" content="Ropat - Portfolio de créations graphiques et design. Découvrez mes projets de pochettes d'album, logos, affiches, animations en motion design et branding.">
        {% else %}
            <meta name="description" content="Ropat - Graphic design portfolio. Explore my projects including album covers, logos, posters, motion design animations, and branding.">
        {% endif %}

        {% if page.meta_keywords %}
            <meta name="keywords" content="{{ page.meta_keywords }}">
        {% elsif page.lang == 'fr' %}
            <meta name="keywords" content="graphiste, designer graphique, portfolio, créations graphiques, Ropat, Angers, France">
        {% else %}
            <meta name="keywords" content="graphic designer, graphic design, portfolio, design creations, Ropat, Angers, France">
        {% endif %}
    {% endif %}
    
    <meta name="author" content="Ropat">
    <meta name="publisher" content="Ropat">
    <meta name="copyright" content="Ropat">
    <meta name="robots" content="index, follow">

    <!-- Canonical -->
    <link rel="canonical" href="{{ page.canonical_url | default: site.url | append: page.url }}">

    <!-- Sitemap -->
    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/style.css">

    <!-- Preconnect pour optimiser le chargement des fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <!-- Preload critical assets -->
    <link rel="preload" href="/assets/images/backgrounds/main-bg.webp" as="image">

    <!-- JS -->
    <script src="/assets/js/script.js" defer></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JDE6T1D92Q"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-JDE6T1D92Q');
    </script>

    <!-- Icon -->
    <link rel="icon" href="/assets/images/branding/icon.png" type="image/png">

    <!-- Open Graph -->
    {% include open-graph.html %}
    <!-- Schema.org -->
    {% include schema-org.html %}
</head>
<body>
    <!-- Language Detection Script -->
    {% include lang-detector.html %}
    
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KN22K5FS"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    {% include header.html %}

    {{ content }} 

    {% include footer.html %}
</body>
</html>