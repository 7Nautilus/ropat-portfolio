<!DOCTYPE html>
<html lang="{{ page.lang | default: 'en' }}">
<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KN22K5FS');</script>
    <!-- End Google Tag Manager -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="language" content="{{ page.lang | default: 'en' }}"> 

    {% comment %} Si c'est une page de projet, charger les métadonnées depuis projects.yml {% endcomment %}
    {% if page.project_id %}
      {% assign project = site.data.projects | where: "project_title", page.project_id | first %}
      {% assign lang = page.lang | default: "fr" %}
      {% if project.seo %}
        {% assign page_title = project.seo.title[lang] %}
        {% assign page_meta_description = project.seo.meta_description[lang] %}
        {% assign page_meta_keywords = project.seo.meta_keywords[lang] %}
        {% assign page_canonical_url = project.seo.canonical_url[lang] %}
        {% assign page_og_title = project.seo.og_title[lang] %}
        {% assign page_og_description = project.seo.og_description[lang] %}
        {% assign page_og_url = project.seo.og_url[lang] %}
        {% assign page_og_image = project.seo.og_image %}
      {% endif %}
    {% endif %}
    
    {% comment %} Utiliser les valeurs du frontmatter ou celles de projects.yml {% endcomment %}
    {% assign final_title = page.title | default: page_title %}
    {% assign final_meta_description = page.meta_description | default: page_meta_description %}
    {% assign final_meta_keywords = page.meta_keywords | default: page_meta_keywords %}
    {% assign final_canonical_url = page.canonical_url | default: page_canonical_url %}
    {% assign final_og_title = page.og_title | default: page_og_title %}
    {% assign final_og_description = page.og_description | default: page_og_description %}
    {% assign final_og_url = page.og_url | default: page_og_url %}
    {% assign final_og_image = page.og_image | default: page_og_image %}

    {% assign page_path_no_lang = page.url | remove_first: "/fr" | remove_first: "/en" %}
    
    {% comment %} Gestion spéciale pour la page d'accueil {% endcomment %}
    {% if page_path_no_lang == "/index.html" or page_path_no_lang == "/" %}
      <link rel="alternate" hreflang="fr" href="{{ site.url }}/index.html" />
      <link rel="alternate" hreflang="en" href="{{ site.url }}/en/index.html" />
      <link rel="alternate" hreflang="x-default" href="{{ site.url }}/en/index.html" />
    {% else %}
      <link rel="alternate" hreflang="fr" href="{{ site.url }}/fr{{ page_path_no_lang }}" />
      <link rel="alternate" hreflang="en" href="{{ site.url }}/en{{ page_path_no_lang }}" />
      <link rel="alternate" hreflang="x-default" href="{{ site.url }}/en{{ page_path_no_lang }}" />
    {% endif %}

    <!-- SEO - Gestion des métadonnées -->
    {% if final_title %}
        <!-- Page avec métadonnées dans le front matter ou projects.yml -->
        <title>{{ final_title }}</title>
        <meta name="title" content="{{ final_title }}">
        
        {% if final_meta_description %}
            <meta name="description" content="{{ final_meta_description }}">
        {% elsif page.lang == 'fr' %}
            <meta name="description" content="Ropat - Portfolio de créations graphiques et design. Découvrez mes projets de pochettes d'album, logos, affiches, animations en motion design et branding.">
        {% else %}
            <meta name="description" content="Ropat - Graphic design portfolio. Explore my projects including album covers, logos, posters, motion design animations, and branding.">
        {% endif %}

        {% if final_meta_keywords %}
            <meta name="keywords" content="{{ final_meta_keywords }}">
        {% elsif page.lang == 'fr' %}
            <meta name="keywords" content="graphiste, designer graphique, portfolio, créations graphiques, Ropat, Angers, France">
        {% else %}
            <meta name="keywords" content="graphic designer, graphic design, portfolio, design creations, Ropat, Angers, France">
        {% endif %}
    {% endif %}
    
    <meta name="author" content="Ropat">
    <meta name="publisher" content="Ropat">
    <meta name="copyright" content="Ropat">
    <meta name="robots" content="index, follow">

    <!-- Canonical -->
    <link rel="canonical" href="{{ final_canonical_url | default: site.url | append: page.url }}">

    <!-- Sitemap -->
    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml">

    <!-- CSS -->
    <link rel="stylesheet" href="/assets/css/style.css">

    <!-- Preconnect pour optimiser le chargement des fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <!-- Preload critical assets -->
    <link rel="preload" href="/assets/images/backgrounds/main-bg.webp" as="image">

    <!-- JS -->
    <script src="/assets/js/script.js" defer></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JDE6T1D92Q"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-JDE6T1D92Q');
    </script>

    <!-- Icon -->
    <link rel="icon" href="/assets/images/branding/icon.png" type="image/png">

    <!-- Open Graph -->
    {% include open-graph.html 
        og_title=final_og_title 
        og_description=final_og_description 
        og_image=final_og_image 
        og_url=final_og_url 
        page_title=final_title 
        page_meta_description=final_meta_description 
    %}
    <!-- Schema.org -->
    {% include schema-org.html 
        page_title=final_title 
        page_meta_description=final_meta_description 
    %}
    
    <!-- Project Schema.org -->
    {% include project-schema.html %}
</head>
<body>
    <!-- Skip to content link for accessibility -->
    <a href="#main-content" class="skip-link">
      {% if page.lang == 'fr' %}
        Aller au contenu principal
      {% else %}
        Skip to main content
      {% endif %}
    </a>
    
    <!-- Language Detection Script -->
    {% include lang-detector.html %}
    
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KN22K5FS"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    {% include header.html %}

    {{ content }} 

    {% include footer.html %}
</body>
</html>