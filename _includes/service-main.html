{% assign current_lang = page.lang | default: "en" %}
{% assign service = site.data.services | where: "id", include.service_id | first %}
{% if service %}
  {% assign hero = service.hero[current_lang] | default: service.hero.en %}
  {% assign hero_title = hero.title | default: service.title[current_lang] %}
  {% assign hero_intro = hero.hero_intro %}
  {% assign hero_cta = hero.cta %}
  {% assign hero_cta_text = hero_cta.text | default: "" %}
  {% assign hero_cta_url = hero_cta.url | default: "" %}
  {% assign first_section_subtitle = service.subtitles.first_section[current_lang] %}
  {% assign first_section_description = services.description[current_lang] %}
  {% assign second_section_subtitle = service.subtitles.second_section[current_lang] %}
  {% if current_lang == "fr" %}
    {% assign service_label = "Service" %}
    {% assign gallery_title = "Projets récents" %}
    {% assign gallery_cta_label = "Voir tous les projets" %}
    {% assign gallery_cta_url = "/fr/portfolio.html" %}
    {% assign tools_title = "Outils et expertises" %}
    {% assign highlight_fallback_title = "Pourquoi choisir Ropat ?" %}
    {% assign process_fallback_title = "Collaborer ensemble" %}
    {% assign final_cta_title = "Prêt à lancer votre projet ?" %}
    {% assign final_cta_description = "Que vous soyez un artiste, un collectif ou une marque, je suis là pour créer un univers visuel qui vous représente." %}
    {% assign final_cta_button_text = "Discutons de votre projet" %}
    {% assign final_cta_button_url = "/fr/contact.html" %}
  {% else %}
    {% assign service_label = "Service" %}
    {% assign gallery_title = "Recent projects" %}
    {% assign gallery_cta_label = "Browse all projects" %}
    {% assign gallery_cta_url = "/en/portfolio.html" %}
    {% assign tools_title = "Tools & expertise" %}
    {% assign highlight_fallback_title = "Why partner with Ropat?" %}
    {% assign process_fallback_title = "How we collaborate" %}
    {% assign final_cta_title = "Ready to launch your project?" %}
    {% assign final_cta_description = "Whether you're an artist, a collective or a brand, let's craft a visual universe that feels like you." %}
    {% assign final_cta_button_text = "Start a conversation" %}
    {% assign final_cta_button_url = "/en/contact.html" %}
  {% endif %}
  {% if hero_cta %}
    {% assign cta_text = hero_cta.text | default: final_cta_button_text %}
    {% assign cta_url = hero_cta.url | default: final_cta_button_url %}
  {% else %}
    {% assign cta_text = final_cta_button_text %}
    {% assign cta_url = final_cta_button_url %}
  {% endif %}
  <main id="main-content" class="main-content service-detail">
    <section class="service-hero">
      <!-- Icône du service -->
      {% if service.icon %}
        <div class="service-icon-placeholder big-icon" aria-label="{{ service.icon_aria[current_lang] }}">
          {{ service.icon | raw }}
        </div>
      {% endif %}
      <!-- Label du service -->
      <h1 class="service-hero-title">{{ hero_title }}</h1>
      <!-- Texte d'accroche-->
      {% if hero_intro %}
        <p class="service-hero-intro">{{ hero_intro }}</p>
      {% endif %}
      <!-- CTA -->
      <a class="cta" href="{{ hero_cta_url }}">{{ hero_cta_text }}</a>
    </section>
    <!-- 1ère sections - Services Card -->
    <section class="services-cards-section">
      <h2 class="section-title">{{ first_section_subtitle }}</h2>
      <div class="section-grid section-grid-simple">
        {% for service_item in service.services %}
          <div class="service-card service-card-simple">
            <div class="service-text-content">
              <h3 class="service-card-title">{{ service_item.nom[current_lang] }}</h3>
              {% if service_item.description %}
                <p class="service-card-description">{{ service_item.description[current_lang] }}</p>
              {% endif %}
            </div>
            {% if service_item.tools %}
              <div class="service-tools">
                {% for tool in service_item.tools %}
                  <span class="service-tool">{{ tool.nom }}</span>
                {% endfor %}
              </div>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </section>
    <section>
      <h2 class="section-title">{{ second_section_subtitle }}</h2>
      <!-- Projects Grid -->
    <div class="section-grid" id="projects-grid">
      <!-- Include Projects with "Music" category -->
      {% assign project_slugs = site.data.projects.index.order %}
      {% assign featured_index = 0 %}
      {% assign featured_rendered = 0 %}
      {% for slug in project_slugs %}
        {% assign item = site.data.projects[slug] %}
        {% if item.category and item.category contains "music" %}
          {% include project-card.html project=item index=featured_index disable_animation=true %}
          {% assign featured_index = featured_index | plus: 1 %}
          {% assign featured_rendered = featured_rendered | plus: 1 %}
          {% if featured_rendered == 4 %}
            {% break %}
          {% endif %}
        {% endif %}
      {% endfor %}
      <div>
        <a href="/fr/projets">
          Voir tous les projets
        </a>
      </div>
    </section>
  </main>
{% endif %}
