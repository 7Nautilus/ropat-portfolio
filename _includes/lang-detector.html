{% comment %}
  Script de détection de langue du navigateur
  Ce script redirige automatiquement l'utilisateur vers la version linguistique appropriée
  basée sur la langue de son navigateur, sauf s'il a déjà visité le site (cookie)
{% endcomment %}

<script>
(function() {
  // Vérifier si l'utilisateur a déjà fait un choix de langue (cookie)
  function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();
    return null;
  }

  function setCookie(name, value, days) {
    const expires = new Date();
    expires.setTime(expires.getTime() + days * 24 * 60 * 60 * 1000);
    document.cookie = `${name}=${value};expires=${expires.toUTCString()};path=/`;
  }

  // Si l'utilisateur a déjà fait un choix, ne rien faire
  if (getCookie('lang_choice')) {
    return;
  }

  // Détecter la langue du navigateur
  const userLang = navigator.language || navigator.userLanguage;
  const langCode = userLang.toLowerCase().split('-')[0]; // 'fr-FR' devient 'fr'

  // Page actuelle
  const currentPath = window.location.pathname;
  
  // Détecter si on est sur la page racine (française par défaut)
  const isRootPage = currentPath === '/' || currentPath === '/index.html';
  const isFrenchPage = currentPath.startsWith('/fr/') || isRootPage;
  const isEnglishPage = currentPath.startsWith('/en/');
  
  // Si l'utilisateur préfère l'anglais et qu'il est sur une page française
  if (langCode !== 'fr' && isFrenchPage && !isEnglishPage) {
    // Construire l'URL anglaise équivalente
    let englishPath;
    if (isRootPage) {
      englishPath = '/en/index.html';
    } else {
      englishPath = currentPath.replace('/fr/', '/en/');
    }
    setCookie('lang_choice', 'en', 30); // Cookie valide 30 jours
    window.location.href = englishPath;
  } 
  // Si l'utilisateur préfère le français et qu'il est sur une page anglaise
  else if (langCode === 'fr' && isEnglishPage) {
    // Construire l'URL française équivalente
    let frenchPath = currentPath.replace('/en/', '/fr/');
    // Si c'est /en/index.html, rediriger vers la racine
    if (frenchPath === '/fr/index.html') {
      frenchPath = '/index.html';
    }
    setCookie('lang_choice', 'fr', 30);
    window.location.href = frenchPath;
  }
  // Pour toute autre langue que FR/EN, rediriger vers l'anglais par défaut
  else if (langCode !== 'fr' && langCode !== 'en' && isFrenchPage && !isEnglishPage) {
    let englishPath;
    if (isRootPage) {
      englishPath = '/en/index.html';
    } else {
      englishPath = currentPath.replace('/fr/', '/en/');
    }
    setCookie('lang_choice', 'en', 30);
    window.location.href = englishPath;
  }
  // Sinon, enregistrer le choix implicite basé sur la page actuelle
  else {
    const currentLang = isEnglishPage ? 'en' : 'fr';
    setCookie('lang_choice', currentLang, 30);
  }
})();
</script>
