{% comment %}
  1. Détermine la langue actuelle de la page à partir du front matter.
  Le défaut est 'en', car c'est la langue par défaut du site.
{% endcomment %}
{% assign current_lang = page.lang | default: 'en' %}

{% comment %}
  2. Retire le préfixe de langue de l'URL pour obtenir le chemin de la page (ex: /about.html)
  Gestion spéciale pour la page d'accueil
{% endcomment %}
{% assign path_no_lang = page.url | remove_first: "/fr" | remove_first: "/en" %}

{% comment %}
  2bis. Gestion spécifique pour les pages Services dont les slugs diffèrent selon la langue
{% endcomment %}
{% assign switch_url = nil %}
{% if page.service_id %}
  {% assign service_item = site.data.services | where: "id", page.service_id | first %}
  {% if service_item %}
    {% if current_lang == 'fr' %}
      {% assign switch_url = service_item.detail_url.en %}
    {% else %}
      {% assign switch_url = service_item.detail_url.fr %}
    {% endif %}
  {% endif %}
{% endif %}

{% if switch_url == nil %}
{% if path_no_lang == "/index.html" or path_no_lang == "/" %}
  {% if current_lang == 'fr' %}
    {% assign switch_url = '/en/index.html' %}
  {% else %}
    {% assign switch_url = '/index.html' %}
  {% endif %}
{% else %}
  {% if current_lang == 'fr' %}
    {% assign switch_url = '/en' | append: path_no_lang %}
  {% else %}
    {% assign switch_url = '/fr' | append: path_no_lang %}
  {% endif %}
{% endif %}
{% endif %}

<div class="lang-selector-container">
    {% if current_lang == 'fr' %}
        <a href="{{ switch_url }}" class="lang-switch-link" onclick="setLangCookie('en')">
            English
        </a>
    {% else %}
        <a href="{{ switch_url }}" class="lang-switch-link" onclick="setLangCookie('fr')">
            Français
        </a>
    {% endif %}
</div>

<script>
  // Fonction pour mettre à jour le cookie de langue lors d'un changement manuel
  function setLangCookie(lang) {
    const expires = new Date();
    expires.setTime(expires.getTime() + 30 * 24 * 60 * 60 * 1000); // 30 jours
    document.cookie = `lang_choice=${lang};expires=${expires.toUTCString()};path=/`;
  }
</script>